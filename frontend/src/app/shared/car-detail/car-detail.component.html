<section id="carDetailPopup" class="bg-black/30 h-full fixed inset-0 overflow-y-auto lg:p-8 hidden z-50">
  <section class="p-5 md:p-10 bg-[#fffbf3] h-full overflow-y-auto hide-scrollbar relative rounded-[8px]">
    <!-- Close button -->
    <section
      class="max-md:top-1 max-md:right-1 absolute right-4 top-4 font-bold cursor-pointer text-2xl hover:text-red-700"
      (click)="carDetailPopupRemove()">
      <img src="shared-icons/Vector.svg" alt="">
    </section>

    <!-- Car images and details section -->
    <section class="flex flex-col gap-4 rounded-[8px] mb-4 lg:gap-4 lg:grid lg:grid-cols-36 bg-white">
      <!-- Thumbnail Column -->
      <section class="flex flex-row justify-between lg:grid lg:col-span-4 gap-2 lg:gap-4">
        <section *ngFor="let image of carImages; let i = index" (click)="setMainImage(i)"
          class="cursor-pointer hover:opacity-75 transition-opacity">
          <img [src]="image" [alt]="'Car thumbnail ' + (i + 1)"
            class="rounded-lg object-cover h-[4rem] md:h-[6rem] xl:h-[8rem] 2xl:h-[10rem] w-full">
        </section>
      </section>

      <!-- Main Image Column -->
      <section class=" lg:col-span-21">
        <img [src]="carImages[selectedImageIndex]" [alt]="'car_image'"
          class="h-[35rem] xl:h-[45rem] 2xl:h-[55rem] w-full object-cover rounded-2xl">
      </section>

      <!-- Car Details Column -->
      <section class="bg-[#f0f0f0] flex flex-col gap-6 p-4 rounded-lg lg:col-span-11 lg:text-xs xl:text-base">
        <section class="flex items-baseline justify-between border-b-[1px] border-gray-400">
          <section class="flex flex-col">
            <h2 class="lg:text-lg xl:text-2xl">{{ carDetails.model }}</h2>
            <p class="text-gray-600 mb-4">{{ carDetails.location }}</p>
          </section>
          <section class="flex items-center gap-1 xl:text-xl">
            <span>{{ carDetails.carRating }}</span>
            <svg class="w-4 h-4 text-yellow-400 xl:scale-150" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          </section>
        </section>

        <!-- Car Features -->
        <section class="grid grid-cols-2 gap-4 h-min">
          <section *ngFor="let feature of carFeatures" class="flex items-center gap-2">
            <img [src]="feature.icon" class="text-gray-600">
            <span>{{ feature.value }}</span>
          </section>
        </section>

        <!-- Date Selection -->
        <section class="grid grid-cols-2 gap-4 p-4 rounded-[8px] content-center border border-black h-min">
          <section class="relative">
            <input type="date" [(ngModel)]="startDate" (change)="calculatePrice()"
              class="w-full p-2 border border-[#dcdcdd] rounded-lg">
          </section>
          <section class="relative">
            <input type="date" [(ngModel)]="endDate" (change)="calculatePrice()"
              class="w-full p-2 border border-[#dcdcdd] rounded-lg">
          </section>
        </section>

        <!-- Book Button -->
        <button (click)="goToConfirmationPage()" [disabled]="!isValidBooking()"
          class="w-full bg-red-600 text-white text-[18px] rounded-[30px] h-min p-4 hover:bg-red-700 transition-colors disabled:bg-gray-400">
          Book the car - ${{ totalPrice }}/day
        </button>
      </section>
    </section>

    <!-- Feedback Section -->
    <section class="bg-[#f0f0f0] p-4 rounded-lg">
      <section class="flex justify-between py-2 border-b border-[#dcdcdd]">
        <h3 class="text-base sm:text-xl font-semibold">Feedback</h3>
        <section class="flex justify-end items-center sm:gap-[10px]">
          <span class="text-[#666666] text-sm">Sort by</span>
          <select [(ngModel)]="sortOrder" (change)="sortFeedback()" class="rounded-lg outline-0 inline-block text-sm ">
            <option value="newest">The newest</option>
            <option value="oldest">The oldest</option>
            <option value="rating">Highest rating</option>
          </select>
        </section>
      </section>

      <!-- Feedback Items -->
      <section class="mb">
        <section *ngFor="let feedback of paginatedFeedbacks"
          class="border-b border-[#dcdcdd] flex flex-col py-4 gap-4 xl:flex-row">
          <!-- Profile picture with name -->
          <section class="flex gap-2 items-center lg:w-1/5">
            <section class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden">
              <img [src]="feedback.userImage" [alt]="feedback.userName" class="w-full h-full object-cover">
            </section>
            <span class="text-[14px]">{{ feedback.userName }}</span>
          </section>
          <!-- Comment with rating -->
          <section>
            <section class="flex gap-1">
              <ng-container *ngFor="let star of [1,2,3,4,5]">
                <section class="relative inline-block">
                  <svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                  <section class="absolute top-0 left-0 overflow-hidden"
                    [style.width]="getStarWidth(star, feedback.rating)">
                    <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  </section>
                </section>
              </ng-container>
            </section>
            <p class="text-gray-600">{{ feedback.comment }}</p>
          </section>
          <section class="xl:w-1/10 xl:flex justify-end">
            <span class="text-gray-500">{{ feedback.date | date:'dd.MM.yyyy' }}</span>
          </section>
        </section>
      </section>

      <!-- Page controller for feedbacks -->
      <section class="flex justify-center items-center gap-1 pt-8">
        <!-- Page Numbers -->
        <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
          <button (click)="goToPage(i + 1)" [class.bg-black]="currentPage === i + 1"
            [class.text-white]="currentPage === i + 1"
            class="w-7 h-7 rounded-full flex items-center justify-center text-sm font-medium transition-colors">
            {{ i + 1 }}
          </button>
        </ng-container>
        <!-- Next Arrow -->
        <button (click)="nextPage()" [disabled]="currentPage === totalPages"
          class="w-7 h-7 flex items-center justify-center disabled:opacity-50">
          <img src="shared-icons/flowbite_arrow-right-outline.svg" alt="">
        </button>
      </section>
    </section>
  </section>
</section>